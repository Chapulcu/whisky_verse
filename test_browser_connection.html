<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase Connection Test</title>
</head>
<body>
  <h1>Supabase Connection Test</h1>
  <div id="output"></div>
  
  <script type="module">
    import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js'
    
    const output = document.getElementById('output')
    
    function log(message) {
      output.innerHTML += `<p>${message}</p>`
      console.log(message)
    }
    
    async function testConnection() {
      log('üîó Starting Supabase connection test...')
      
      const supabaseUrl = 'https://example.supabase.co'
      const supabaseKey = 'eeeelsldklgodmkmkm5km4√∂m√∂-3m√∂m.eyJpc3M1dW9qY3B5Iiwicm9sZSCI6MjA3MTE1NjM0MX0.YU6bUsKYOrMlmlRtb-Wafr6em9DEaEY9tZEyyApXNUM'
      
      try {
        const supabase = createClient(supabaseUrl, supabaseKey)
        
        log('‚úÖ Supabase client created')
        
        // Test basic query
        const { data, error } = await supabase
          .from('whiskies')
          .select('id, name')
          .limit(3)
        
        if (error) {
          log(`‚ùå Query failed: ${error.message}`)
          log(`Error details: ${JSON.stringify(error, null, 2)}`)
        } else {
          log(`‚úÖ Query successful: ${data.length} records found`)
          data.forEach(item => log(`  - ${item.name}`))
        }
        
        // Test auth
        const { data: { session }, error: sessionError } = await supabase.auth.getSession()
        
        if (sessionError) {
          log(`‚ùå Session check failed: ${sessionError.message}`)
        } else {
          log(`‚úÖ Session check: ${session ? 'Authenticated' : 'Not authenticated'}`)
        }
        
        // Test network directly
        log('üåê Testing direct network connection...')
        const response = await fetch(`${supabaseUrl}/rest/v1/whiskies?select=id,name&limit=3`, {
          headers: {
            'apikey': supabaseKey,
            'Authorization': `Bearer ${supabaseKey}`,
            'Content-Type': 'application/json'
          }
        })
        
        if (response.ok) {
          const networkData = await response.json()
          log(`‚úÖ Direct network call successful: ${networkData.length} records`)
        } else {
          log(`‚ùå Direct network call failed: ${response.status} ${response.statusText}`)
        }
        
      } catch (error) {
        log(`‚ùå Unexpected error: ${error.message}`)
        console.error('Full error:', error)
      }
    }
    
    testConnection()
  </script>
</body>
</html>
